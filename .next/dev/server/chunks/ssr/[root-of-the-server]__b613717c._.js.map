{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/hannahcho/Downloads/hackwestern/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,kMAAO,EAAC,IAAA,yKAAI,EAAC;AACtB"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///Users/hannahcho/Downloads/hackwestern/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn('leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn('px-6', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///Users/hannahcho/Downloads/hackwestern/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',\n        secondary:\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost:\n          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\n        icon: 'size-9',\n        'icon-sm': 'size-8',\n        'icon-lg': 'size-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,mMAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,oMAAI,GAAG;IAE9B,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///Users/hannahcho/Downloads/hackwestern/components/ui/textarea.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Textarea({ className, ...props }: React.ComponentProps<'textarea'>) {\n  return (\n    <textarea\n      data-slot=\"textarea\"\n      className={cn(\n        'border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,SAAS,EAAE,SAAS,EAAE,GAAG,OAAyC;IACzE,qBACE,0QAAC;QACC,aAAU;QACV,WAAW,IAAA,8IAAE,EACX,ucACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///Users/hannahcho/Downloads/hackwestern/components/ui/input.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Input({ className, type, ...props }: React.ComponentProps<'input'>) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',\n        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,0QAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,8IAAE,EACX,8bACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///Users/hannahcho/Downloads/hackwestern/components/ai-chat-modal.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { Card } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { X, Send } from \"lucide-react\"\nimport ReactMarkdown from \"react-markdown\"\nimport remarkGfm from \"remark-gfm\"\n\ninterface Message {\n  role: \"user\" | \"ai\" | \"context\"\n  content: string\n}\n\ninterface AIChatModalProps {\n  isOpen: boolean\n  onClose: () => void\n  initialMessages?: Message[]\n  fullText?: string\n  highlightedText?: string\n}\n\nexport function AIChatModal({\n  isOpen,\n  onClose,\n  initialMessages = [],\n  fullText = \"\",\n  highlightedText = \"\",\n}: AIChatModalProps) {\n  const [messages, setMessages] = useState<Message[]>(initialMessages)\n  const [input, setInput] = useState(\"\")\n  const [isLoading, setIsLoading] = useState(false)\n\n  useEffect(() => {\n    if (initialMessages.length > 0) {\n      setMessages(initialMessages)\n    }\n  }, [initialMessages])\n\n  const handleSendMessage = async () => {\n    if (input.trim()) {\n      const userMessage: Message = { role: \"user\", content: input }\n      setMessages((prev) => [...prev, userMessage])\n      setInput(\"\")\n      setIsLoading(true)\n\n      try {\n        const response = await fetch(\"/api/gemini\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            fullText: fullText,\n            highlightedText: highlightedText,\n            userQuestion: input,\n          }),\n        })\n\n        const data = await response.json()\n\n        const aiResponse: Message = {\n          role: \"ai\",\n          content: data.answer || data.error || \"Unable to get response from AI.\",\n        }\n        setMessages((prev) => [...prev, aiResponse])\n      } catch (error) {\n        const errorMessage: Message = {\n          role: \"ai\",\n          content: \"Failed to connect to AI service. Please try again later.\",\n        }\n        setMessages((prev) => [...prev, errorMessage])\n      } finally {\n        setIsLoading(false)\n      }\n    }\n  }\n\n  if (!isOpen) return null\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-2xl max-h-[80vh] flex flex-col border-pink-200 shadow-2xl\">\n        <div className=\"bg-pink-500 text-white p-4 rounded-t-lg flex items-center justify-between\">\n          <div>\n            <h3 className=\"font-semibold text-lg\">AI Learning Assistant</h3>\n            <p className=\"text-xs opacity-90\">Powered by Gemini</p>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose} className=\"text-white hover:bg-pink-600\">\n            <X className=\"w-5 h-5\" />\n          </Button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\n          {messages.map((message, index) => (\n            <div\n              key={index}\n              className={`flex ${message.role === \"user\" ? \"justify-end\" : message.role === \"context\" ? \"justify-center\" : \"justify-start\"}`}\n            >\n              <div\n                className={`max-w-[80%] rounded-lg p-4 ${\n                  message.role === \"user\"\n                    ? \"bg-pink-500 text-white\"\n                    : message.role === \"context\"\n                      ? \"bg-pink-50 text-pink-900 border border-pink-200 italic text-sm\"\n                      : \"bg-gray-100 text-gray-900\"\n                }`}\n              >\n                {message.role === \"ai\" ? (\n                  <div className=\"prose prose-sm max-w-none prose-headings:mt-3 prose-headings:mb-2 prose-p:my-2 prose-li:my-1\">\n                    <ReactMarkdown remarkPlugins={[remarkGfm]}>{message.content}</ReactMarkdown>\n                  </div>\n                ) : (\n                  <p className=\"text-sm leading-relaxed\">{message.content}</p>\n                )}\n              </div>\n            </div>\n          ))}\n          {isLoading && (\n            <div className=\"flex justify-start\">\n              <div className=\"bg-gray-100 text-gray-900 rounded-lg p-4\">\n                <p className=\"text-sm leading-relaxed\">Thinking...</p>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <div className=\"p-4 border-t border-gray-200\">\n          <div className=\"flex gap-2\">\n            <Input\n              placeholder=\"Ask a follow-up question...\"\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyPress={(e) => e.key === \"Enter\" && !isLoading && handleSendMessage()}\n              className=\"flex-1 border-pink-200 focus:border-pink-400\"\n              disabled={isLoading}\n            />\n            <Button\n              onClick={handleSendMessage}\n              disabled={!input.trim() || isLoading}\n              className=\"bg-pink-500 hover:bg-pink-600 text-white\"\n            >\n              <Send className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 526, "column": 0}, "map": {"version":3,"sources":["file:///Users/hannahcho/Downloads/hackwestern/components/global-highlight-handler.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\nimport { useEffect, useState } from \"react\"\nimport { Card } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { Sparkles, X } from \"lucide-react\"\nimport { AIChatModal } from \"./ai-chat-modal\"\nimport ReactMarkdown from \"react-markdown\"\nimport remarkGfm from \"remark-gfm\"\n\ninterface SelectionPosition {\n  top: number\n  left: number\n}\n\ninterface Message {\n  role: \"user\" | \"ai\" | \"context\"\n  content: string\n}\n\nexport function GlobalHighlightHandler({ children }: { children: React.ReactNode }) {\n  const [selectedText, setSelectedText] = useState(\"\")\n  const [fullText, setFullText] = useState(\"\")\n  const [showConfirmation, setShowConfirmation] = useState(false)\n  const [showPlaceholder, setShowPlaceholder] = useState(false)\n  const [confirmationPosition, setConfirmationPosition] = useState<SelectionPosition>({ top: 0, left: 0 })\n  const [placeholderPosition, setPlaceholderPosition] = useState<SelectionPosition>({ top: 0, left: 0 })\n  const [followUpQuestion, setFollowUpQuestion] = useState(\"\")\n  const [isChatModalOpen, setIsChatModalOpen] = useState(false)\n  const [chatInitialMessages, setChatInitialMessages] = useState<Message[]>([])\n  const [aiInsight, setAiInsight] = useState<string>(\"\")\n  const [isLoadingInsight, setIsLoadingInsight] = useState(false)\n\n  useEffect(() => {\n    const handleSelection = () => {\n      setTimeout(() => {\n        const selection = window.getSelection()\n\n        if (!selection || selection.rangeCount === 0) {\n          return\n        }\n\n        const text = selection.toString().trim()\n\n        if (text.length >= 3) {\n          const range = selection.getRangeAt(0)\n          const rect = range.getBoundingClientRect()\n\n          let parentElement = range.commonAncestorContainer\n          if (parentElement.nodeType === Node.TEXT_NODE) {\n            parentElement = parentElement.parentElement as Node\n          }\n          const fullContext = (parentElement as HTMLElement)?.textContent?.trim() || text\n          setFullText(fullContext)\n\n          setConfirmationPosition({\n            top: rect.bottom + window.scrollY + 8,\n            left: rect.left + window.scrollX + rect.width / 2,\n          })\n\n          setSelectedText(text)\n          setShowConfirmation(true)\n          setShowPlaceholder(false)\n        } else {\n          if (text.length === 0) {\n            setShowConfirmation(false)\n          }\n        }\n      }, 10)\n    }\n\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as HTMLElement\n\n      // Don't close if clicking inside popup elements\n      if (\n        target.closest(\"[data-confirmation-popup]\") ||\n        target.closest(\"[data-placeholder-box]\") ||\n        target.closest(\"[data-chat-modal]\")\n      ) {\n        return\n      }\n\n      // Close popups when clicking outside\n      setShowConfirmation(false)\n      setShowPlaceholder(false)\n    }\n\n    document.addEventListener(\"mouseup\", handleSelection)\n    document.addEventListener(\"touchend\", handleSelection)\n    document.addEventListener(\"click\", handleClickOutside)\n\n    return () => {\n      document.removeEventListener(\"mouseup\", handleSelection)\n      document.removeEventListener(\"touchend\", handleSelection)\n      document.removeEventListener(\"click\", handleClickOutside)\n    }\n  }, [])\n\n  const handleAskAI = async () => {\n    setShowConfirmation(false)\n\n    setPlaceholderPosition({\n      top: confirmationPosition.top + 50,\n      left: confirmationPosition.left,\n    })\n\n    setShowPlaceholder(true)\n    setIsLoadingInsight(true)\n    setAiInsight(\"\")\n\n    window.getSelection()?.removeAllRanges()\n\n    try {\n      const response = await fetch(\"/api/gemini\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          fullText: fullText,\n          highlightedText: selectedText,\n          userQuestion: \"\",\n        }),\n      })\n\n      const data = await response.json()\n      setAiInsight(data.answer || data.error || \"Unable to get response from AI.\")\n    } catch (error) {\n      console.error(\"[v0] Error fetching AI insight:\", error)\n      setAiInsight(\"Failed to connect to AI service. Please try again later.\")\n    } finally {\n      setIsLoadingInsight(false)\n    }\n  }\n\n  const handleContinueToChat = async () => {\n    if (followUpQuestion.trim()) {\n      const contextMessage: Message = {\n        role: \"context\",\n        content: `Context: \"${selectedText}\"`,\n      }\n      const userMessage: Message = {\n        role: \"user\",\n        content: followUpQuestion,\n      }\n      const loadingMessage: Message = {\n        role: \"ai\",\n        content: \"Thinking...\",\n      }\n\n      setChatInitialMessages([contextMessage, userMessage, loadingMessage])\n      setIsChatModalOpen(true)\n      setShowPlaceholder(false)\n\n      const questionToAsk = followUpQuestion\n      setFollowUpQuestion(\"\")\n\n      try {\n        const response = await fetch(\"/api/gemini\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            fullText: fullText,\n            highlightedText: selectedText,\n            userQuestion: questionToAsk,\n          }),\n        })\n\n        const data = await response.json()\n\n        const aiMessage: Message = {\n          role: \"ai\",\n          content: data.answer || data.error || \"Unable to get response from AI.\",\n        }\n\n        setChatInitialMessages([contextMessage, userMessage, aiMessage])\n      } catch (error) {\n        console.error(\"[v0] Error fetching AI response:\", error)\n        const errorMessage: Message = {\n          role: \"ai\",\n          content: \"Failed to connect to AI service. Please try again later.\",\n        }\n        setChatInitialMessages([contextMessage, userMessage, errorMessage])\n      }\n    }\n  }\n\n  const handleClosePlaceholder = () => {\n    setShowPlaceholder(false)\n    setFollowUpQuestion(\"\")\n    setAiInsight(\"\")\n    setIsLoadingInsight(false)\n  }\n\n  const handleCancelConfirmation = () => {\n    setShowConfirmation(false)\n    window.getSelection()?.removeAllRanges()\n  }\n\n  return (\n    <>\n      {children}\n\n      {/* Confirmation Popup */}\n      {showConfirmation && (\n        <div\n          data-confirmation-popup\n          className=\"absolute animate-in fade-in duration-200\"\n          style={{\n            top: `${confirmationPosition.top}px`,\n            left: `${confirmationPosition.left}px`,\n            transform: \"translateX(-50%)\",\n            zIndex: 50,\n            pointerEvents: \"none\",\n          }}\n        >\n          <Card className=\"px-4 py-3 border-pink-300 shadow-lg bg-white\" style={{ pointerEvents: \"auto\" }}>\n            <div className=\"flex items-center gap-3\">\n              <Sparkles className=\"w-4 h-4 text-pink-500\" />\n              <span className=\"text-sm text-foreground font-medium\">Ask AI about this?</span>\n              <div className=\"flex gap-2\">\n                <Button\n                  onClick={handleAskAI}\n                  size=\"sm\"\n                  className=\"bg-pink-500 hover:bg-pink-600 text-white text-xs px-3 py-1 h-auto\"\n                >\n                  Yes\n                </Button>\n                <Button\n                  onClick={handleCancelConfirmation}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"text-gray-600 text-xs px-2 py-1 h-auto\"\n                >\n                  <X className=\"w-3 h-3\" />\n                </Button>\n              </div>\n            </div>\n          </Card>\n        </div>\n      )}\n\n      {/* Inline Placeholder Box */}\n      {showPlaceholder && (\n        <div\n          data-placeholder-box\n          className=\"absolute w-[90%] max-w-md animate-in fade-in slide-in-from-top-4 duration-300\"\n          style={{\n            top: `${placeholderPosition.top}px`,\n            left: `${placeholderPosition.left}px`,\n            transform: \"translateX(-50%)\",\n            zIndex: 50,\n            pointerEvents: \"none\",\n          }}\n        >\n          <Card className=\"p-5 border-pink-300 shadow-2xl bg-white\" style={{ pointerEvents: \"auto\" }}>\n            <div className=\"space-y-4\">\n              <div>\n                <h3 className=\"font-semibold text-foreground flex items-center gap-2 mb-2\">\n                  <Sparkles className=\"w-5 h-5 text-pink-500\" />\n                  AI Insight\n                </h3>\n                <div className=\"bg-pink-50 border border-pink-200 rounded-lg p-3 mb-3\">\n                  <p className=\"text-sm text-pink-900 italic\">\"{selectedText}\"</p>\n                </div>\n                <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-3\">\n                  {isLoadingInsight ? (\n                    <p className=\"text-sm text-gray-600\">Analyzing with Gemini...</p>\n                  ) : (\n                    <div className=\"text-sm text-gray-900 leading-relaxed prose prose-sm max-w-none prose-headings:text-gray-900 prose-p:text-gray-900 prose-strong:text-gray-900 prose-code:text-pink-600 prose-code:bg-pink-50 prose-code:px-1 prose-code:rounded\">\n                      <ReactMarkdown remarkPlugins={[remarkGfm]}>{aiInsight || \"No response yet.\"}</ReactMarkdown>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium text-foreground\">Ask a follow-up question:</label>\n                <Textarea\n                  placeholder=\"Ask for more help or clarification...\"\n                  value={followUpQuestion}\n                  onChange={(e) => setFollowUpQuestion(e.target.value)}\n                  onKeyPress={(e) => {\n                    if (e.key === \"Enter\" && !e.shiftKey) {\n                      e.preventDefault()\n                      handleContinueToChat()\n                    }\n                  }}\n                  className=\"border-pink-200 focus:border-pink-400 resize-none\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"ghost\" size=\"sm\" onClick={handleClosePlaceholder} className=\"text-gray-600\">\n                  Cancel\n                </Button>\n                <Button\n                  onClick={handleContinueToChat}\n                  disabled={!followUpQuestion.trim()}\n                  size=\"sm\"\n                  className=\"bg-pink-500 hover:bg-pink-600 text-white\"\n                >\n                  Continue in Chat\n                </Button>\n              </div>\n            </div>\n          </Card>\n        </div>\n      )}\n\n      {/* Reusable AI Chat Modal */}\n      <div data-chat-modal>\n        <AIChatModal\n          isOpen={isChatModalOpen}\n          onClose={() => {\n            setIsChatModalOpen(false)\n            setChatInitialMessages([])\n          }}\n          initialMessages={chatInitialMessages}\n          fullText={fullText}\n          highlightedText={selectedText}\n        />\n      </div>\n    </>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}